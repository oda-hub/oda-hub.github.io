<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Workflow development Guide Workflows are all things that can be computed, broadly speaking.
For reproducibility, we want our workflows to be repeatable: producing the same output every time they are computed. This is easy enough to do in first approximation, but might be harder to achieve than it seems when the workflow relies on external resources. But we track every execution so it is not necessary to be overly concerned about these delicate details at every moment.">
<meta name="theme-color" content="#FFFFFF">
<meta name="color-scheme" content="light dark"><meta property="og:title" content="" />
<meta property="og:description" content="Workflow development Guide Workflows are all things that can be computed, broadly speaking.
For reproducibility, we want our workflows to be repeatable: producing the same output every time they are computed. This is easy enough to do in first approximation, but might be harder to achieve than it seems when the workflow relies on external resources. But we track every execution so it is not necessary to be overly concerned about these delicate details at every moment." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://odahub.io/docs/guide-development/" />

<title>Guide Development | About ODA</title>
<link rel="manifest" href="../../manifest.json">
<link rel="icon" href="../../favicon.png" type="image/x-icon">
<link rel="stylesheet" href="../../book.min.a64c3fbabd2c7a93ee90dd37db9054580fcb37b8eef93f80b6fa286b030f64af.css" integrity="sha256-pkw/ur0sepPukN0325BUWA/LN7ju&#43;T&#43;AtvooawMPZK8=" crossorigin="anonymous">
  <script defer src="../../flexsearch.min.js"></script>
  <script defer src="../../en.search.min.cdfd4273a6a9ee039e544892b72c33c2ddaeb40b5b5a6f8f43b992c04db4d169.js" integrity="sha256-zf1Cc6ap7gOeVEiStywzwt2utAtbWm&#43;PQ7mSwE200Wk=" crossorigin="anonymous"></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  <script src="https://hypothes.is/embed.js" async></script>
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="../../"><span>About ODA</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>












  



  
  <ul>
    
      
        <li>
          
  
  

  
    <a href="../../docs/guide-development/" class="active">Guide Development</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="../../docs/guide-discovery/" class="">Guide Discovery</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="../../docs/guide-ontology/" class="">Guide Ontology</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="../../docs/issues/" class="">Issues</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="../../docs/reasoning-engine/" class="">Reasoning Engine</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="../../docs/workflow-development-progression/" class="">Workflow Development Progression</a>
  

        </li>
      
    
  </ul>















</nav>




  <script>(function(){var menu=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="../../svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Guide Development</strong>

  <label for="toc-control">
    
    <img src="../../svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#simple-oda-jupyter-notebook-to-a-workflow">Simple ODA Jupyter Notebook to a workflow</a>
      <ul>
        <li><a href="#write-a-working-repeatable-workflow">Write a working repeatable workflow</a></li>
        <li><a href="#parametetrize-the-notebook">Parametetrize the notebook</a></li>
        <li><a href="#annotate-the-notebook-outputs">Annotate the notebook outputs</a></li>
        <li><a href="#publish-your-workflow-as-a-test-service">Publish your workflow as a test service</a></li>
        <li><a href="#optional-try-a-test-service">(optional) Try a test service</a></li>
        <li><a href="#optional-add-some-verification-test-cases">(optional) Add some verification test cases</a></li>
      </ul>
    </li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown"><h1 id="workflow-development-guide">Workflow development Guide</h1>
<p>Workflows are all things that can be computed, broadly speaking.</p>
<p>For reproducibility, we want our workflows to be repeatable: producing the same output every time they are computed.
This is easy enough to do in first approximation, but might be harder to achieve than it seems when the workflow relies on external resources. But we track every execution so it is not necessary to be overly concerned about these delicate details at every moment.</p>
<p>Generally, we want the workflows to be parametrized. Non-parametrized but strickly repeatable notebooks are equivalent to their output data.</p>
<p>One way to create them in ODA is to build <strong>jupyter notebook</strong>.</p>
<h2 id="simple-oda-jupyter-notebook-to-a-workflow">Simple ODA Jupyter Notebook to a workflow</h2>
<h3 id="write-a-working-repeatable-workflow">Write a working repeatable workflow</h3>
<p>First you need to make sure your notebook runs in a cloud environment. It needs to be repeatable - i.e. you can run it many times. If it depends on external services - try to make sure the requests are also repeatable - you might need to specify sufficient details. If the notebook does not produce the exactly
the same result every time - it&rsquo;s unfortunate, but do not worry too much, it might still be reproducible (see motivation on <a href="https://github.com/volodymyrss/reproducibility-motivation/">the difference between reproducibility and repeatability</a>)</p>
<ul>
<li>write your notebook, and make sure it runs from top to bottom</li>
<li>make a requirements.txt will the modules you need for this notebook</li>
</ul>
<p>You can use a mock <a href="https://renkulab.io/gitlab/astronomy/mmoda/lightcurve-example">lightcurve notebook</a> as an example.</p>
<h3 id="parametetrize-the-notebook">Parametetrize the notebook</h3>
<ul>
<li>create a cell with the following tag &ldquo;parameters&rdquo; (see <a href="https://papermill.readthedocs.io/en/latest/usage-parameterize.html#designate-parameters-for-a-cell">papermill manual</a>):</li>
</ul>
<h3 id="annotate-the-notebook-outputs">Annotate the notebook outputs</h3>
<ul>
<li>define the notebook output, similarly creating cell with tag &ldquo;outputs&rdquo;.
<ul>
<li>outputs may be strings, floats, lists</li>
<li>outputs may be also strings which contain filenames for valid files. If they do, the whole file will be considered output.</li>
</ul>
</li>
<li>if you want to give more detailed description of the notebook input and output, use <code>terms</code> from the <a href="docs/guide-ontology.">ontology</a>.</li>
</ul>
<h3 id="publish-your-workflow-as-a-test-service">Publish your workflow as a test service</h3>
<ul>
<li>publish the workflow to RenkuLab in the dedicated group: <a href="https://renkulab.io/gitlab/astronomy/mmoda/">https://renkulab.io/gitlab/astronomy/mmoda/</a></li>
<li>add a &ldquo;live-workflow&rdquo; topic.</li>
</ul>
<p><img src="../live-workflow-tag-set.png" alt="" />
<img src="../live-workflow-tag.png" alt="" /></p>
<ul>
<li>once some bots do their job, the workflow will be automatically installed in <a href="https://www.astro.unige.ch/mmoda">MMODA</a> (by default, on a staging instance), and you will recieve an email!</li>
</ul>
<h4 id="try-to-access-your-new-service">Try to access your new service</h4>
<ul>
<li>Assuming <code>lightcurve-example</code> from above was used, and the notebook name was <code>random</code>, you can run this:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ oda-api -u https://dispatcher-staging.obsuks1.unige.ch get -i lightcurve-example -p random -a n_bins<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>
</code></pre></div><p>TODO: workflow version, plot here and in renku create</p>
<h3 id="optional-try-a-test-service">(optional) Try a test service</h3>
<ul>
<li>install nb2workflow tooling <code>pip install nb2workflow[cwl,oda] --upgrade</code></li>
<li>inspect the notebook <code>nbinspect my-notebook.ipynb</code></li>
<li>try to run the notebook <code>nbrun my-notebook.ipynb</code>
<ul>
<li>it will use all default parameters</li>
<li>you can specify parameters as <code>nbrun --inp-nbins=10 my-notebook.ipynb</code>, if <code>nbins</code> happens to be one of the parameters.</li>
</ul>
</li>
<li>try to start the service <code>nb2service my-notebook.ipynb</code></li>
<li>try containerized service <code>nb2deploy $PWD test --local</code></li>
</ul>
<h3 id="optional-add-some-verification-test-cases">(optional) Add some verification test cases</h3>
<p>To make sure your service does not break with future updates, it&rsquo;s useful to express some assumptions about the service outputs in some reference cases.
They will be tested automatically every time new workflow version is installed.</p>
<p>we will explain later how to do this.</p>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>



  <script>(function(){function select(element){const selection=window.getSelection();const range=document.createRange();range.selectNodeContents(element);selection.removeAllRanges();selection.addRange(range);}
document.querySelectorAll("pre code").forEach(code=>{code.addEventListener("click",function(event){if(window.getSelection().toString()){return;}
select(code.parentElement);if(navigator.clipboard){navigator.clipboard.writeText(code.parentElement.textContent);}});});})();</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#simple-oda-jupyter-notebook-to-a-workflow">Simple ODA Jupyter Notebook to a workflow</a>
      <ul>
        <li><a href="#write-a-working-repeatable-workflow">Write a working repeatable workflow</a></li>
        <li><a href="#parametetrize-the-notebook">Parametetrize the notebook</a></li>
        <li><a href="#annotate-the-notebook-outputs">Annotate the notebook outputs</a></li>
        <li><a href="#publish-your-workflow-as-a-test-service">Publish your workflow as a test service</a></li>
        <li><a href="#optional-try-a-test-service">(optional) Try a test service</a></li>
        <li><a href="#optional-add-some-verification-test-cases">(optional) Add some verification test cases</a></li>
      </ul>
    </li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












